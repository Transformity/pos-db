-- Modify "invoice_item" table
ALTER TABLE "public"."invoice_item" ADD COLUMN "case_ordered" integer NOT NULL DEFAULT 0, ADD COLUMN "size" numeric NULL, ADD COLUMN "size_unit" text NULL, ADD COLUMN "department" character varying(255) NULL, ADD COLUMN "net_unit_ordered" integer NOT NULL GENERATED ALWAYS AS (quantity + (case_ordered * units_per_case)) STORED, ADD COLUMN "net_unit_cost" numeric(38,2) NOT NULL GENERATED ALWAYS AS ((((COALESCE(case_cost, (0)::numeric) / (units_per_case)::numeric) * ((case_ordered * units_per_case))::numeric) + ((quantity)::numeric * unit_cost)) / (COALESCE(NULLIF((quantity + (case_ordered * units_per_case)), 0), 1))::numeric) STORED, ADD CONSTRAINT "invoice_item_department_name_fk" FOREIGN KEY ("department") REFERENCES "public"."department" ("name") ON UPDATE NO ACTION ON DELETE NO ACTION;
